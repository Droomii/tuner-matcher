<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!-- JAVA와 연결할 Mapper 파일 설정 -->
<mapper namespace="poly.persistance.mapper.IReqMapper">

	<!-- 시군구 모두 얻기 -->
	<insert id="insertReq" parameterType="ReqDTO">
	INSERT INTO REQUEST(
		REQ_SEQ,
		USER_SEQ,
		PIANO_SEQ,
		REQ_CONTENT,
		PHOTO_DIR,
		PREF_DATE,
		REGDATE,
		UPDDATE,
		UPDATER_SEQ,
		REQ_TITLE
	)VALUES(
		REQ_SEQ.NEXTVAL,
		#{user_seq},
		#{piano_seq},
		#{req_content},
		#{photo_dir},
		#{pref_date},
		SYSDATE,
		SYSDATE,
		#{user_seq},
		#{req_title}
	)
	
	</insert>
	<select id="getPublicReqList" parameterType="String" resultType="ReqDTO">
	SELECT
		R.REQ_SEQ AS REQ_SEQ,
		R.PIANO_SEQ AS PIANO_SEQ,
		P.PIANO_NAME AS PIANO_NAME,
		R.REQ_TITLE AS REQ_TITLE,
		R.REGDATE AS REGDATE,
		NVL((SELECT COUNT(1) FROM DEAL GROUP BY REQ_SEQ HAVING REQ_SEQ=R.REQ_SEQ),0) AS BIDS
	FROM
		REQUEST R,
		PIANO P
	WHERE
		USER_SEQ=#{0}
		AND  R.PIANO_SEQ=P.PIANO_SEQ
		AND R.REQ_TYPE=0
	</select>
	<select id="getReqDetail" parameterType="String" resultType="ReqDTO">
	SELECT
		R.REQ_SEQ,
		R.USER_SEQ,
		R.PIANO_SEQ,
		R.REQ_TITLE,
		R.REQ_CONTENT,
		R.REQ_TYPE,
		R.PREF_DATE,
		P.SIDO_NAME,
		P.SGG_NAME
		
	FROM
		REQUEST R, PIANO P
	WHERE
		REQ_SEQ=#{0}
		AND R.PIANO_SEQ=P.PIANO_SEQ
	</select>
	<delete id="deleteReq" parameterType="String">
	DELETE FROM REQUEST WHERE REQ_SEQ=#{0}
	</delete>
	<select id="getNearReqList" parameterType="String" resultType="ReqDTO">
	SELECT
		R.REQ_SEQ,
		R.REQ_TITLE,
		R.REQ_CONTENT,
		NVL((SELECT COUNT(1) FROM DEAL GROUP BY REQ_SEQ HAVING REQ_SEQ=R.REQ_SEQ),0) AS BIDS,
		P.SIDO_NAME,
		P.SGG_NAME,
		P.X_POS,
		P.Y_POS,
		P.ADDR
	FROM REQUEST R, PIANO P
	WHERE 
		R.PIANO_SEQ=P.PIANO_SEQ
		AND P.SGG_CODE LIKE #{0}
		AND R.REQ_TYPE=0
	</select>
</mapper>